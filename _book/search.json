[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Proof of concept for health indicators",
    "section": "",
    "text": "1 Introduction\nOutline an end-to-end process for creating public health indicators and generating public health profiles.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#global-workflow",
    "href": "index.html#global-workflow",
    "title": "Proof of concept for health indicators",
    "section": "1.1 Global workflow",
    "text": "1.1 Global workflow\n\n\n\n\n\n\nflowchart TD\n\nA[Source datasets] --&gt; B[Cleaning] \nB --&gt; C[Recode area names to match across datasets] --&gt; E\nD --&gt; E[Aggregate indicator data by gender, age-band and area]\nB --&gt; D[Create age bands from ages]\nE --&gt; F[Link aggregate indicator data to population data]\nF --&gt; G[Calculate rate and unceratinty intervals]\nG --&gt; H[Pool regional rates across indicators]\nH--&gt; I[Generate regional profile visualisations]\n\nclassDef green fill:#9f6,stroke:#333,stroke-width:2px;\n     classDef orange fill:#f96,stroke:#333,stroke-width:4px;\n     class D,e green\n     class B orange\n\n\n\n\n\n\nFigure 1.1: Workflow",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "ind-def.html",
    "href": "ind-def.html",
    "title": "2  Indicator definitions",
    "section": "",
    "text": "2.1 Anti-microbial resistance\nPercentage of bloodstream infections due to selected antimicrobial-resistant organisms (MRSA, Escherichia coli resistant to 3rd-generation cephalosporin (e.g., ESBL- E. coli))",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Indicator definitions</span>"
    ]
  },
  {
    "objectID": "ind-def.html#anti-microbial-resistance",
    "href": "ind-def.html#anti-microbial-resistance",
    "title": "2  Indicator definitions",
    "section": "",
    "text": "2.1.1 Staphylococcus aureus\n\n\ntitledenominatornumeratormetricnotesPercentage of bloodstream infections due to selected antimicrobial-resistant organisms: MRSATotal No. of patients with growth of S. aureus in tested blood samplesNo. of patients with growth of methicillin-resistant S. aureus in tested blood samplesProportion\n\n\n\n\n2.1.2 Escherichia coli\n\n\ntitledenominatornumeratormetricnotesPercentage of bloodstream infections due to selected antimicrobial-resistant organisms: E.coliTotal No. of patients with growth of E. coli in tested blood samplesNo. of patients with growth of E.coli resistant to 3rd generation cephalosporins in tested blood samplesProportionResistance to ceftazidine, cefotaxine",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Indicator definitions</span>"
    ]
  },
  {
    "objectID": "ind-def.html#smoking",
    "href": "ind-def.html#smoking",
    "title": "2  Indicator definitions",
    "section": "2.2 Smoking",
    "text": "2.2 Smoking\nCurrent cigarette smoking among women aged 18-44 years\n\n\ntitledenominatornumeratormetricnotesPCurrent cigarette smoking among women aged 18-44 yearsWomen aged 18-44 years who information about cigarette smoking (excluding unknowns and refusals).Women aged 18-44 years who reported that they smoked ≥100 cigarettes in their lifetime and currently smoke every day or some days.Rate with 95% confidence intervalsData provided is attendances at smoking clinics rather than survey based smoking prevalence",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Indicator definitions</span>"
    ]
  },
  {
    "objectID": "ind-def.html#injury",
    "href": "ind-def.html#injury",
    "title": "2  Indicator definitions",
    "section": "2.3 Injury",
    "text": "2.3 Injury\nNonfatal hospitalizations for all injuries\n\n\ntitledenominatornumeratormetricnotesNonfatal hospitalizations for all injuriesMidyear population for the calendar year under surveillance obtained from the KSA Census or suitable alternative.Nonfatal hospitalizations with any of the following ICD-10-CM diagnostic codes in the principal diagnosis fieldRate (age standardised) with 95% confidence intervalsData provided is attendances at smoking clinics rather than survey based smoking prevalence",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Indicator definitions</span>"
    ]
  },
  {
    "objectID": "ind-def.html#flu-vaccination-coverage",
    "href": "ind-def.html#flu-vaccination-coverage",
    "title": "2  Indicator definitions",
    "section": "2.4 Flu vaccination coverage",
    "text": "2.4 Flu vaccination coverage\n\n2.4.1 Paediatric\n\n\ntitledenominatornumeratormetricnotesPopulation vaccination coverage - Flu (pediatric group 6 months - 18 years old))The total number of children eligible for influenza vaccinationThe total number of children in the respective eligible age cohort that have received at least one dose of influenza vaccine from 1 Oct in school, pharmacy, and general practice.Proportion with 95% confidence intervalsData provided is attendances at smoking clinics rather than survey based smoking prevalence\n\n\n\n\n2.4.2 At-risk groups\nThe dataset required for calculating coverage for at-risk groups is much more complex than for age-specific coverage rates because it needs details of underlying diseases e.g. asthma, COPD.\n\n\n2.4.3 65+\n\n\ntitledenominatornumeratormetricnotesPopulation vaccination coverage - Flu (65+))The total number of adults 65+ eligible for influenza vaccinationThe total number of children in the respective eligible age cohortProportion with 95% confidence intervalsData provided is attendances at smoking clinics rather than survey based smoking prevalence",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Indicator definitions</span>"
    ]
  },
  {
    "objectID": "data-summaries.html",
    "href": "data-summaries.html",
    "title": "3  Data summaries",
    "section": "",
    "text": "3.1 AMR\nThe dummy data is per patient sample based.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Data summaries</span>"
    ]
  },
  {
    "objectID": "data-summaries.html#amr",
    "href": "data-summaries.html#amr",
    "title": "3  Data summaries",
    "section": "",
    "text": "3.1.1 E. coli\n\n\n\nTable 3.1: E. coli resistance rates to 3rd generation cephalosporins\n\n\n\n\n\n\n\n\nage_bandresistantsensitivetotalsum_ressum_totmean_ratevaluelowerclupperclconfidencemethod[0,5)8614831520.5460.5710.32590.78695%Wilson[10,15)1831520.54695%Wilson[15,20)123831520.5460.3330.06150.79295%Wilson[20,25)213831520.5460.6670.20770.93995%Wilson[25,30)1831520.54695%Wilson[30,35)336831520.5460.5000.18760.81295%Wilson[35,40)246831520.5460.3330.09680.70095%Wilson[40,45)134831520.5460.2500.04560.69995%Wilson[45,50)123831520.5460.3330.06150.79295%Wilson[50,55)7310831520.5460.7000.39680.89295%Wilson[55,60)9615831520.5460.6000.35750.80295%Wilson[60,65)11920831520.5460.5500.34210.74295%Wilson[65,70)9716831520.5460.5620.33180.76995%Wilson[70,75)5813831520.5460.3850.17710.64595%Wilson[75,80)549831520.5460.5560.26670.81195%Wilson[80,85)10616831520.5460.6250.38640.81595%Wilson[85,90)257831520.5460.2860.08220.64195%Wilson[90,95)527831520.5460.7140.35890.91895%Wilson[95,100)1831520.54695%Wilson\n\n\n\n\n\n\n\n\n\n\nFigure 3.1: e. coli resistance\n\n\n\n\n\n\n\n3.1.2 S.aureus\n\n\n\n\nTable 3.2: MRSA\n\n\n\nage_bandresistantsensitivetotalsum_ressum_totmean_ratevaluelowerclupperclconfidencemethod[0,5)433500.6695%Wilson[10,15)11233500.660.5000.09450.90595%Wilson[15,20)233500.6695%Wilson[20,25)133500.6695%Wilson[25,30)233500.6695%Wilson[30,35)33633500.660.5000.18760.81295%Wilson[35,40)41533500.660.8000.37550.96495%Wilson[40,45)133500.6695%Wilson[45,50)12333500.660.3330.06150.79295%Wilson[50,55)11233500.660.5000.09450.90595%Wilson[55,60)26833500.660.2500.07150.59195%Wilson[60,65)61733500.660.8570.48690.97495%Wilson[65,70)11233500.660.5000.09450.90595%Wilson[70,75)41533500.660.8000.37550.96495%Wilson[75,80)12333500.660.3330.06150.79295%Wilson[80,85)41533500.660.8000.37550.96495%Wilson[85,90)11233500.660.5000.09450.90595%Wilson\n\n\n\n\n\n\n\n\n\n\n\n\n\nFigure 3.2: Staph aureus resistance rates",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Data summaries</span>"
    ]
  },
  {
    "objectID": "data-summaries.html#flu-vaccination-coverage",
    "href": "data-summaries.html#flu-vaccination-coverage",
    "title": "3  Data summaries",
    "section": "3.2 Flu vaccination coverage",
    "text": "3.2 Flu vaccination coverage\n\n\n\n\nTable 3.3: Counts of flu vaccination by age group, gender and region\n\n\n\nage_groupsgenderAl BahaAl JawfAl QassimAsirHailJazanMakkah Al MukarramahNajranNorthern FrontierRiyadhSharqiyaTabukmadina0-18female38150161343728218136131191400-18male21833620188212223459165+female1493264319162465+male10429513214otherfemale691577531671051,1824821,260102127765othermale917429537120938501536199229443",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Data summaries</span>"
    ]
  },
  {
    "objectID": "data-summaries.html#smoking",
    "href": "data-summaries.html#smoking",
    "title": "3  Data summaries",
    "section": "3.3 Smoking",
    "text": "3.3 Smoking\nCounts of female smoking clinic attendees by directorate for 15+ and 18-44 years\n\n\n\n\nTable 3.4: Counts of female attendees at smoking cessation clinics\n\n\n\nage_1844directorate_namefemale1AlAhsa731Asir91Baha281Bisha61Eastern5511Hafer AlBatin601Hail221Jazan1451Jeddah1,5691Jouf231Madinah2051Makkah5781Najran821Northern Borders41Qassim221Qunfotha131Riyadh1,8301Tabuk2911Taif100\n\n\nage_15directorate_namefemale1AlAhsa931Asir841Baha281Bisha61Eastern5791Hafer AlBatin601Hail221Jazan1581Jeddah1,7881Jouf281Madinah3031Makkah6361Najran851Northern Borders71Qassim481Qunfotha131Qurayyat41Riyadh1,8621Tabuk4361Taif136",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Data summaries</span>"
    ]
  },
  {
    "objectID": "data-summaries.html#injury",
    "href": "data-summaries.html#injury",
    "title": "3  Data summaries",
    "section": "3.4 Injury",
    "text": "3.4 Injury\n\n\n\n\n\n\n\n\nFigure 3.3: Alluvial plot of counts of hospitalisation for injury be age, gender and ICD10 code",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Data summaries</span>"
    ]
  },
  {
    "objectID": "demog.html",
    "href": "demog.html",
    "title": "4  Population demography",
    "section": "",
    "text": "4.1 Population pyramids\n(a) Absolute population\n\n\n\n\n\n\n\n\n\n\n\n(b) Relative population\n\n\n\n\n\n\nFigure 4.1: Population pyramids",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Population demography</span>"
    ]
  },
  {
    "objectID": "getting-started.html",
    "href": "getting-started.html",
    "title": "5  Data pre-processing",
    "section": "",
    "text": "5.1 Getting started\nThese pages set out the process for loading, cleaning, reshaping and recoding provided datasets for calculating indicator values as a proof of concept, and creating a health profile from those indicators.\nTo facilitate reproducibility the analyses are written in R code in the form of a notebook and R scripts which do much of the pre-processing. The full code is made available as a Github repository at https://github.com/julianflowers/poc. The files can be cloned (downloaded)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data pre-processing</span>"
    ]
  },
  {
    "objectID": "getting-started.html#getting-started",
    "href": "getting-started.html#getting-started",
    "title": "5  Data pre-processing",
    "section": "",
    "text": "In RStudio, go to “File &gt; New Project”\nClick on “Version Control:\nCheckout a project from a version control repository”\nClick on “Git:\nClone a project from a repository”\nFill in the info: URL: use HTTPS address\nCreate as a subdirectory of: Browse to where you would like to create this folder\n\n\n5.1.1 The indicators\n4 sets of indicators are used for this PoC:\n\nMethicillin resistant Staph aureus and 3rd generation cephalosporin resistant E.coli - proportion of samples tested which are resistant\nFlu vaccination coverage rates\nSmoking rates in women\nInjury admission rates\n\nFully specifying the indicators\n\nThe proportion of blood samples which grow either Staph aureaus or E. coli, which are tested for antibiotic sensitivity and which are found to be resistant to oxacllin or 3rd generation cephalosporins respectively for time period X to Y, stratified by [area] / [time period] / [age group] / [gender]\nThe proportion of the population which has been vaccinated against flu for the time period X to Y stratified by [area] / [time period] / [age group] / [gender]\nThe rate of smoking in women aged 15+ / 18-44, per 100,000 female population for the time period X to Y stratified by [area] / [time period] / [age group] / [gender]\nThe rate of hospitalisation for injury for the time period X to Y stratified by [area] / [time period] / [age group] / [gender]\n\n\n\n5.1.2 Pre-processing script\nAs a first step we will run a script which does a number of things.\n\nImports the datasets for each indicator\nLoads KSA 2022 census data by age, gender and region1\nMakes variable names consistent\nRecodes region names so that they match the names used in the Census 2022 data\nMaps directorate names (used in smoking data) to region2\nEnsures numeric variables (e.g. age) are converted to numbers\nCreates a set of intermediate data tables\nSaves file of reshaped population data,\n\nThe intermediate tables can be reused for further analysis and generating profiles.\nThe script can be run by typing\n`source(\"~/proof-of-concept/scripts/pre-process.R\")`\n\nat the prompt in the console\nThis generates a set of objects in the R environment\n\n\nCode\nobjects() \n\n\n[1] \"RETICULATE_PYTHON\"\n\n\nObjects called dfs reflect pre-processing of the original datasets. Objects containing names, contain the different variables used for age, gender and area variables across datasets. Those called sc are used to map locations of smoking clinics as part of recoding directorates to regions for the smoking data (see below).\nThe object regional_counts_complete is a data frame of regional age_band, gender specific counts for each indicator and forms the basis of indicator generation. Note, this includes region-age-band-gender combinations for which there is no data (because these combinations are not present in the original data - although they maybe in the full datasets).\n\n\nCode\nregional_counts_complete &lt;- read_csv(\"data/regional_counts.csv\")\n\nregional_counts_complete |&gt;\n    head() |&gt;\n    flextable::flextable()\n\n\n\n\n\nRegionage_bandsum_f_Smokingsum_f_flusum_f_injurysum_m_Smokingsum_m_flusum_m_injury`Asir[0,5)140160260`Asir[5,10)0711`Asir[10,15)543552`Asir[15,20)39132,7444`Asir[20,25)7925`Asir[25,30)1762122\n\n\n\nTable 5.1: Region age-band specific counts by gender and indicator\n\n\n\n\n\n\n5.1.3 Mapping health directorates to regions for smoking data\nThe smoking data provided is clinic based data disaggregated at the level of health directorate. There are 20 directorates in KSA, and 13 regions.\nAvailable population data is at regional level, so to generate population denominators for the smoking data I have mapped directorates to regions as follows:\n\nI used a dataset which contained spatial locations of healthcare facilities (smoking cessation clinics) at health directorate level3\nFor each location I extracted spatial coordinates (longitude and latitude)\nI obtained a regional boundary file (shape file) from https://data.humdata.org/dataset/41ce9023-1d21-4549-a485-94316200aba0/resource/99834c81-ad34-415e-91c5-af053d8e55b4/download/sau_capp_adm1_1m_ocha.zip\nI spatially joined the clinic location and boundary files (see\n\n\n\nThis created a lookup table for directorates and regions and enabled the smoking data to be recoded to regions and calculation of rates using the census regional population estimates\n\n\n\nCode\nsa_bound &lt;- read_sf(\"data/ksa_bound.gml\")\nsc_ll_sf &lt;- read_sf(\"data/smok_loc.gml\")\n\nsc_ll_sf |&gt;\n    ggplot() +\n    geom_sf(data = sa_bound) +\n    geom_sf(aes(colour = name)) \n\n\n\n\n\n\n\n\nFigure 5.1: Location map of smoking clinics mapped to KSA regional boundaries",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data pre-processing</span>"
    ]
  },
  {
    "objectID": "getting-started.html#footnotes",
    "href": "getting-started.html#footnotes",
    "title": "5  Data pre-processing",
    "section": "",
    "text": "Note. The census data was downloaded from https://tableau.saudicensus.sa/#/views/TA3-PopulationbydetailedAgebyRegionGovernorateNationalityandGenderAR_16850208449070/PopulationbydetailedAgebyRegionGovernorateNationalityandGenderARCSV.csv and variable and region names translated to English using ChatGPT4o↩︎\nThis uses the spatial locations of smoking clinics which include directorate names to map to KSA regional boundaries↩︎\nhttps://www.moh.gov.sa/en/Ministry/Projects/TCP/Pages/default.aspx↩︎",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Data pre-processing</span>"
    ]
  },
  {
    "objectID": "amr_poc.html",
    "href": "amr_poc.html",
    "title": "6  AMR walkthrough",
    "section": "",
    "text": "6.1 Introduction\nThis document outlines a stepwise approach to calculating AMR indicators from dummy data kindly supplied by PHA.\nThere are x steps",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#introduction",
    "href": "amr_poc.html#introduction",
    "title": "6  AMR walkthrough",
    "section": "",
    "text": "EDA (exploratory data analysis of raw data) - this involves cleaning, visualisation and creation of relevant variables.\nReview of indicator definitions\n\nNumerator\nDenominator\n\nMethod for calculating numerator and denominator values from dataset. The outline uses R code for reproducibility and flexibility.\nCalculating indicator values and uncertainty intervals\nSuggested indicator visualisations (if appropriate).",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#amr-indicators",
    "href": "amr_poc.html#amr-indicators",
    "title": "6  AMR walkthrough",
    "section": "6.2 AMR indicators",
    "text": "6.2 AMR indicators\n\n6.2.1 MRSA\n\nPercentage of bloodstream infection due to methicillin-resistant Staphylococcus aureus (MRSA)\n\n\nNumerator: No. of patients with growth of methicillin-resistant S. aureus in tested blood samples\n\n\nDenominator: Total No. of patients with growth of S. aureus in tested blood samples\n\n\n\n6.2.2 E. coli\n\nPercentage of bloodstream infection due to 3rd-generation cephalosporin resistant E. coli\n\n\nNumerator: No. of patients with growth of 3rd-generation cephalosporin resistant E. coli in tested blood samples\n\n\nDenominator: Total No. of patients with growth of E. coli in tested blood samples\n\n\n\n6.2.3 Import data\n\n\nCode\ndf &lt;- amr\n\n\n334 observations",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#data-preparation",
    "href": "amr_poc.html#data-preparation",
    "title": "6  AMR walkthrough",
    "section": "6.3 Data preparation",
    "text": "6.3 Data preparation\n\n6.3.1 calculate 5-year age bands\n\n\nCode\namr &lt;- amr[, `:=` (age_band = cut(age_year, breaks = seq(0, 100, 5), right = FALSE))][]\n\nhead(amr)\n\n\n   record_number sample_no patient_mrn   location\n           &lt;num&gt;    &lt;char&gt;      &lt;char&gt;     &lt;char&gt;\n1:             1    ######       ##### Outpatient\n2:            17    ######       #####  Inpatient\n3:            20    ######       #####  Inpatient\n4:            25    ######       #####  Inpatient\n5:            43    ######       ##### Outpatient\n6:            63    ######       ##### Outpatient\n                                                     patient_hospitalized\n                                                                   &lt;char&gt;\n1: Patient had NOT been admitted for more than 2 days in the past 30 days\n2:                       Patient has been hospitalized for 2 days or less\n3:                     Patient has been hospitalized for more than 2 days\n4:                       Patient has been hospitalized for 2 days or less\n5: Patient had NOT been admitted for more than 2 days in the past 30 days\n6: Patient had NOT been admitted for more than 2 days in the past 30 days\n     specific_location age_year community_origin   site first_name second_name\n                &lt;char&gt;    &lt;num&gt;           &lt;char&gt; &lt;char&gt;     &lt;char&gt;      &lt;char&gt;\n1:      Emergency Room        0 Community Origin  Blood       ####       #####\n2: Intensive Care Unit       71 Community Origin  Blood       ####       #####\n3: Intensive Care Unit       44  Hospital Origin  Blood       ####       #####\n4: Intensive Care Unit       67 Community Origin  Blood       ####       #####\n5:      Emergency Room       67 Community Origin  Blood       ####       #####\n6:      Emergency Room       92 Community Origin  Blood       ####       #####\n   family_name national_iqama_id nationality    pathogen_name minocycline\n        &lt;char&gt;            &lt;char&gt;      &lt;char&gt;           &lt;char&gt;      &lt;lgcl&gt;\n1:        ####        ##########       ##### Escherichia coli          NA\n2:        ####        ##########       ##### Escherichia coli          NA\n3:        ####        ##########       ##### Escherichia coli          NA\n4:        ####        ##########       ##### Escherichia coli          NA\n5:        ####        ##########       ##### Escherichia coli          NA\n6:        ####        ##########       ##### Escherichia coli          NA\n   tigecycline ampicillin penicillin_g oxacillin cefoxitin cefotaxime\n        &lt;lgcl&gt;     &lt;char&gt;       &lt;lgcl&gt;    &lt;char&gt;    &lt;char&gt;     &lt;char&gt;\n1:          NA          R           NA      &lt;NA&gt;      &lt;NA&gt;          R\n2:          NA          R           NA      &lt;NA&gt;      &lt;NA&gt;         NA\n3:          NA          S           NA      &lt;NA&gt;      &lt;NA&gt;          S\n4:          NA          R           NA      &lt;NA&gt;      &lt;NA&gt;          R\n5:          NA          R           NA      &lt;NA&gt;      &lt;NA&gt;         NA\n6:          NA          R           NA      &lt;NA&gt;      &lt;NA&gt;         NA\n   ceftazidime ceftriaxone cefixime cefepime doripenem ertapenem imipenem\n        &lt;char&gt;      &lt;char&gt;   &lt;lgcl&gt;   &lt;char&gt;    &lt;char&gt;    &lt;char&gt;   &lt;char&gt;\n1:           R           R       NA        R        NA         S        S\n2:           S           S       NA        S        NA         S        S\n3:           S           S       NA        S        NA         S        S\n4:           R           R       NA        R        NA         S        S\n5:           I           S       NA        S        NA         S        S\n6:           R           R       NA        R         R         S        S\n   meropenem co_trimoxazole azithromycin amikacin gentamicin ciprofloxacin\n      &lt;char&gt;         &lt;char&gt;       &lt;lgcl&gt;   &lt;lgcl&gt;     &lt;lgcl&gt;        &lt;char&gt;\n1:         S              S           NA       NA         NA             S\n2:         S              S           NA       NA         NA             S\n3:         S              S           NA       NA         NA             S\n4:         S              R           NA       NA         NA             S\n5:         S              S           NA       NA         NA             S\n6:         S              R           NA       NA         NA             R\n   levofloxacin colistin spectinomycin age_band\n         &lt;char&gt;   &lt;char&gt;        &lt;lgcl&gt;   &lt;fctr&gt;\n1:            S       NA            NA    [0,5)\n2:            S        S            NA  [70,75)\n3:            S       NA            NA  [40,45)\n4:            S       NA            NA  [65,70)\n5:            S        S            NA  [65,70)\n6:            R        S            NA  [90,95)\n\n\n\n\n6.3.2 remove non-relevant data\nThis step removes identifiers (names, record IDs)\n\n\nCode\namr &lt;- amr |&gt; select(-c(family_name, first_name, sample_no, patient_mrn, second_name, national_iqama_id, nationality))\n\n\n\n\n6.3.3 create per test file (long data)\n\nthis create a per test dataset rather than a per patient sample dataset\n\n\n\nCode\namr_long &lt;- amr |&gt;\n    pivot_longer(names_to = \"antibiotic\", values_to = \"resistance\", cols = minocycline:spectinomycin) |&gt; setDT()\n\n\n\n\n6.3.4 Recode 3rd generation cephalosporins\n\nthis step adds a new variable which labels 3rd generation cephalosporins\n\n\n\nCode\namr_long &lt;- amr_long[, gen_3 := case_when(str_detect(antibiotic, \"cef\") ~ \"3rd-gen\", TRUE ~ \"other\")][]",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#data-summarisation-and-description-eda",
    "href": "amr_poc.html#data-summarisation-and-description-eda",
    "title": "6  AMR walkthrough",
    "section": "6.4 Data summarisation and description (EDA)",
    "text": "6.4 Data summarisation and description (EDA)\n\nfirst generate a high level tabular summary\n\n\n\nCode\ngtsummary::tbl_summary(amr)\n\n\n\nrepresent this visually - we’ll use decomposition trees\n\n\n\nCode\namr_freq &lt;- amr_long[pathogen_name == \"Escherichia coli\", .N, by = .(age_band, gen_3, resistance, pathogen_name, community_origin)]\n\ncollapsibleTreeSummary(amr_freq, \n                       c( \"community_origin\", \"gen_3\",\"resistance\"), \n                       root = \"E. coli\", \n                       nodeSize = \"N\", \n                       attribute = \"N\", \n                       fontSize = 16, \n                       collapsed = FALSE)\n\n\n\n\n\n\n\n\nFigure 6.1: Decomposition tree for E. coli",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#numerators-and-denominators",
    "href": "amr_poc.html#numerators-and-denominators",
    "title": "6  AMR walkthrough",
    "section": "6.5 Numerators and denominators",
    "text": "6.5 Numerators and denominators\nTo calculate indicators we need to calculate\n\npatients with blood stream infection\nsamples with antibiotic resistance\n\n\n\nCode\namr_long\n\n\nIndex: &lt;pathogen_name&gt;\n      record_number   location\n              &lt;num&gt;     &lt;char&gt;\n   1:             1 Outpatient\n   2:             1 Outpatient\n   3:             1 Outpatient\n   4:             1 Outpatient\n   5:             1 Outpatient\n  ---                         \n7678:          1210  Inpatient\n7679:          1210  Inpatient\n7680:          1210  Inpatient\n7681:          1210  Inpatient\n7682:          1210  Inpatient\n                                                        patient_hospitalized\n                                                                      &lt;char&gt;\n   1: Patient had NOT been admitted for more than 2 days in the past 30 days\n   2: Patient had NOT been admitted for more than 2 days in the past 30 days\n   3: Patient had NOT been admitted for more than 2 days in the past 30 days\n   4: Patient had NOT been admitted for more than 2 days in the past 30 days\n   5: Patient had NOT been admitted for more than 2 days in the past 30 days\n  ---                                                                       \n7678:                     Patient has been hospitalized for more than 2 days\n7679:                     Patient has been hospitalized for more than 2 days\n7680:                     Patient has been hospitalized for more than 2 days\n7681:                     Patient has been hospitalized for more than 2 days\n7682:                     Patient has been hospitalized for more than 2 days\n       specific_location age_year community_origin   site         pathogen_name\n                  &lt;char&gt;    &lt;num&gt;           &lt;char&gt; &lt;char&gt;                &lt;char&gt;\n   1:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   2:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   3:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   4:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   5:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n  ---                                                                          \n7678: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7679: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7680: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7681: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7682: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n      age_band    antibiotic resistance  gen_3\n        &lt;fctr&gt;        &lt;char&gt;     &lt;char&gt; &lt;char&gt;\n   1:    [0,5)   minocycline       &lt;NA&gt;  other\n   2:    [0,5)   tigecycline       &lt;NA&gt;  other\n   3:    [0,5)    ampicillin          R  other\n   4:    [0,5)  penicillin_g       &lt;NA&gt;  other\n   5:    [0,5)     oxacillin       &lt;NA&gt;  other\n  ---                                         \n7678: [95,100)    gentamicin       &lt;NA&gt;  other\n7679: [95,100) ciprofloxacin          R  other\n7680: [95,100)  levofloxacin          R  other\n7681: [95,100)      colistin         NA  other\n7682: [95,100) spectinomycin       &lt;NA&gt;  other",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#calculate-resistance-rates",
    "href": "amr_poc.html#calculate-resistance-rates",
    "title": "6  AMR walkthrough",
    "section": "6.6 Calculate resistance rates",
    "text": "6.6 Calculate resistance rates\n\ncalculate proportion of tests resistant\ncalculate confidence interval (using Wilson’s score method for proportions via the PHEindicatormethods R package)\n\n\n\nCode\namr_long[pathogen_name == \"Escherichia coli\" & !is.na(resistance), .N, by = .(resistance, gen_3)] |&gt;\n    pivot_wider(names_from = resistance, values_from = N) |&gt;\n    rowwise() |&gt;\n    mutate(total_tests = sum(c_across(R:I), na.rm = TRUE), \n           resistance_rate = R / total_tests) |&gt;\n    flextable::flextable()\n\n\n\n\nTable 6.1: E. coli resistance rates to 3rd generation cephalosporins\n\n\n\ngen_3RNASItotal_testsresistance_rateother30019364671,1460.26178013rd-gen2695619245210.5163148\n\n\n\n\n\n\n6.6.1 by antibiotic\n\n\nCode\noptions(digits = 2)\n\namr_res_ci_sa &lt;- amr_long[pathogen_name == \"Staphylococcus aureus\" & !is.na(resistance), .N, by = .(antibiotic, resistance)] |&gt;\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |&gt;\n    rowwise() |&gt;\n    mutate(total_tests = sum(c_across(S:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_sa, R, total_tests) |&gt;\n    bind_cols(amr_res_ci_sa) |&gt;\n    ggplot() +\n    geom_point(aes(reorder(antibiotic, value), value)) +\n    geom_linerange(aes(antibiotic, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"Staph. aureus resistance rate\", x = \"\") + \n    scale_y_continuous(position = \"right\")\n\n\n\n\n\n\n\n\n\n\n\n6.6.2 by age\n\n\nCode\namr_res_ci_age &lt;- amr_long[pathogen_name == \"Staphylococcus aureus\" & !is.na(resistance), .N, by = .(age_band, resistance)] |&gt;\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |&gt;\n    rowwise() |&gt;\n    mutate(total_tests = sum(c_across(S:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_age, R, total_tests) |&gt;\n    bind_cols(amr_res_ci_age) |&gt;\n    ggplot() +\n    geom_point(aes(reorder(age_band, value), value)) +\n    geom_linerange(aes(age_band, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"Staph. aureus resistance rate\", x = \"\") + \n    scale_y_continuous(position = \"right\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "amr_poc.html#e.-coli-1",
    "href": "amr_poc.html#e.-coli-1",
    "title": "6  AMR walkthrough",
    "section": "6.7 E. coli",
    "text": "6.7 E. coli\n\n\nCode\namr_res_ci_ec &lt;- amr_long[str_detect(pathogen_name, \"coli\") & !is.na(resistance), .N, by = .(antibiotic, resistance, gen_3)] |&gt;\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |&gt;\n    rowwise() |&gt;\n    mutate(total_tests = sum(c_across(R:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_ec, R, total_tests) |&gt;\n    bind_cols(amr_res_ci_ec) |&gt;\n    ggplot() +\n    geom_point(aes(reorder(antibiotic, value), value, colour = gen_3)) +\n    geom_linerange(aes(antibiotic, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"E. coli resistance rate\", x = \"\") + scale_y_continuous(position = \"right\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>AMR walkthrough</span>"
    ]
  },
  {
    "objectID": "smoking-poc.html",
    "href": "smoking-poc.html",
    "title": "7  Smoking",
    "section": "",
    "text": "7.1 Workflow\nflowchart TD\nA[Data] --&gt; B[population data]\nA --&gt; C[smoking data]\nC --&gt; D[[reclassify directorate names to regions]] --&gt; E[[calculate age bands]] --&gt; F[[calculate smoking counts]]\nB --&gt; G[[calculate age bands]] --&gt; H[[calculate population counts]]\nH --&gt; I[[join datasets]]\nF --&gt; I\nI --&gt; J[calculate rates and ci]\n\n\n\n\n\nFigure 7.1: Proposed workflow for calculating smoking rates",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Smoking</span>"
    ]
  },
  {
    "objectID": "smoking-poc.html#workflow",
    "href": "smoking-poc.html#workflow",
    "title": "7  Smoking",
    "section": "",
    "text": "7.1.1 Load census population and create age bands\n\n\nCode\n## create age band\n\npops &lt;- setDT(pops)[, `:=` (`18-44`  = dplyr::between(age, 18, 44), `15+` = age &gt;= 15, `80+` = age &gt;= 80, age_band = cut(age, seq(0, 110, 5), right = FALSE))][]\n\npop_age &lt;- pops[, .(n = .N, sumpops = sum(Population, na.rm = TRUE)), by = .(Region, age_band,  Gender)][order(age_band)]\n\npop1844F &lt;- pops[, .(n = .N, sumpops = sum(Population, na.rm = TRUE)), by = .(Region, `18-44`,  Gender)][`18-44` == \"TRUE\" & Gender == \"Female\",]\n\npop15F &lt;- pops[, .(n = .N, sumpops = sum(Population, na.rm = TRUE)), by = .(Region, `15+`,  Gender)][`15+` == \"TRUE\" & Gender == \"Female\",]\n\n\n\n\n7.1.2 Load smoking data and calculate age bands\nNote: it is not clear if the dummy data is a random sample of clinic attendance data.\n\n\nCode\nsmok_age &lt;- smoking[, `:=` (`18-44`  = dplyr::between(age, 18, 44), `15+` = age &gt;= 15, `80+` = age &gt;= 80, age_band = cut(age, seq(0, 110, 5), right = FALSE))][]\n\nsmok_age_bands &lt;- smok_age[, .(n = .N, smokers = sum(n, na.rm = TRUE)), by = .(Region, age_band,  Gender)][order(age_band)]\n\nsmok1844F &lt;- smok_age[, .(n = .N, smokers = sum(n, na.rm = TRUE)), by = .(Region, `18-44`,  Gender)][`18-44` == \"TRUE\" & Gender == \"female\",]\n\nsmok15F &lt;- smok_age[, .(n = .N, smokers = sum(n, na.rm = TRUE)), by = .(Region, `15+`,  Gender)][`15+` == \"TRUE\" & Gender == \"female\",]\n\n\n\n\n7.1.3 Join datasets and calculate rates\nThis step uses Byar’s method for confidence interval for rates\n\n\nCode\nsmok_rates &lt;- pop1844F |&gt;\n    left_join(smok1844F, by = \"Region\") |&gt; \n    phe_rate(x = smokers, n = sumpops) \n\nsmok_rates |&gt;\n    dplyr::select(Region, smokers, population = sumpops, value, lowercl, uppercl) |&gt;\n    flextable::flextable()\n\n\n\n\nRegionsmokerspopulationvaluelowercluppercl'Asir366,324Al Bahah2861,96945.18388230.01772965.30573Al Hudud ash Shamaliyah470,1495.7021481.55364314.59976Al Jawf23103,53622.21449514.07758733.33412Al Madinah al Munawwarah387,944Al Mintaqah ash Sharqiyah877,403Al Qasim249,081Ar Riyadh1,609,493Ha'il22136,64216.10046710.08657124.37741Jazan267,342Makkah al Mukarramah1,507,301Najran82105,91577.42057361.57287696.10050Tabuk291163,453178.032829158.162585199.70848\n\n\nFigure 7.2: Smoking clinic attendance rates (18-44)\n\n\n\n\nCode\nsmok_rates |&gt;\n    write_csv(\"data/smok_rates.csv\")\n   \nsmok_rates |&gt;\n    ggplot() +\n    geom_col(aes(reorder(Region, value), value)) +\n    geom_linerange(aes(x = Region, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(x = \" \",\n         y = \"Rate per 100.000\")\n\n\n\n\n\n\n\n\nFigure 7.3: Smoking clinic attendance rates (18-44)\n\n\n\n\n\n\n\n7.1.4 Age-specific attendance rates\n\n\nCode\nsmok_age_agg &lt;- smok_age_bands[, .(tot_smokers = sum(smokers)), by = .(age_band, Gender)][]\n\noptions(scipen = 999, digitds = 2)\n\n## m:f as smoking ratios\n\nsmok_rates_gender &lt;- pop_age |&gt;\n    dplyr::select(-Region) |&gt;\n    mutate(Gender = recode(Gender, \"Female\" = \"female\", \"Male\" = \"male\")) |&gt;\n    left_join(smok_age_agg, by = c(\"age_band\", \"Gender\")) |&gt;\n    group_by(age_band, Gender) |&gt;\n    reframe(nat_smok = sum(tot_smokers, na.rm = TRUE), \n           nat_pop = sum(sumpops)) |&gt;\n    phe_rate(x = nat_smok, n = nat_pop) |&gt; \n    mutate(value = ifelse(Gender == \"female\", -value, value)) |&gt;\n    ggplot() +\n    geom_col(aes(age_band, value, fill = Gender)) +\n    coord_flip() +\n    scale_fill_manual(values = c(\"blue\", \"red\")) +\n    labs(x = \"\",  y = \"Attendance rate per 100000\")\n\nsmok_rates_gender    \n\n\n\n\n\n\n\n\n\nCode\nsmok_gender_ratio &lt;- pop_age |&gt;\n    dplyr::select(-Region) |&gt;\n    mutate(Gender = recode(Gender, \"Female\" = \"female\", \"Male\" = \"male\")) |&gt;\n    left_join(smok_age_agg, by = c(\"age_band\", \"Gender\")) |&gt;\n    group_by(age_band, Gender) |&gt;\n    reframe(nat_smok = sum(tot_smokers, na.rm = TRUE), \n           nat_pop = sum(sumpops)) |&gt;\n    phe_rate(x = nat_smok, n = nat_pop) |&gt;\n    slice(7:36) |&gt;\n    group_by(age_band) |&gt;\n    reframe(ratio = value[2] / value[1]) |&gt;\n    mutate(mean_ratio = mean(ratio))\n\n\nThe relative attendance rate for males is 17.32 times that of females. Smoking clinic attendance rates could be used as a proxy for population smoking rates if the relationship between attendance and prevalence is known . For example, survey data suggests that KSA male smoking rates are around 20% which implies a female smoking rate based on 1.15%. In fact, available survey data (Algabbani et al. (2018)), and estimates from the Global Burden of Disease ((“Prevalence of Smoking,” n.d.; Xiang et al. 2023)), suggest a smoking prevalence in females over 15 of 2%,\n\n\n\n\n\n\nAlgabbani, Aljoharah Mohammed, Rasha Almubark, Nora Althumiri, Amani Alqahtani, and Nasser BinDhim. 2018. “The Prevalence of Cigarette Smoking in Saudi Arabia in 2018.” Food and Drug Regulatory Science Journal 1 (1): 1. https://doi.org/10.32868/rsj.v1i1.22.\n\n\n“Prevalence of Smoking.” n.d. https://doi.org/10.1787/301887638251.\n\n\nXiang, Hong, Deshi Dong, Linlin Lv, and Xufeng Tao. 2023. “Global Burden of Disease Study 2019 Indicates That Smoking Gradually Becomes a Key Driver of the Burden of Pancreatic Cancer in Developing Regions.” In. IntechOpen. https://doi.org/10.5772/intechopen.1003616.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Smoking</span>"
    ]
  },
  {
    "objectID": "flu.html",
    "href": "flu.html",
    "title": "8  Flu vaccination coverage",
    "section": "",
    "text": "8.1 Workflow\nflowchart TD\nA[Data] --&gt; B[population data]\nA --&gt; C[vaccination data]\nC --&gt; D[[recode region names]] --&gt; E[[calculate age bands]] --&gt; F[[calculate vaccination counts]]\nB --&gt; G[[calculate age bands]] --&gt; H[[calculate population counts]]\nF --&gt; I[[join datasets]]\nH --&gt; I\nI --&gt; J[calculate rates and ci]\n\n\n\n\n\nFigure 8.1: Proposed workflow for calculating flu vaccination coverage",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#clean-data",
    "href": "flu.html#clean-data",
    "title": "8  Flu vaccination coverage",
    "section": "8.2 Clean data",
    "text": "8.2 Clean data\nRecode region names Add new age bands\n\n\nCode\nflu_data &lt;- flu_data |&gt;\n    mutate(paed = dplyr::between(age, 0, 18), \n           older = age &gt;= 65) |&gt;\n    mutate(Region = case_when(str_detect(Region, \"Baha\") ~ \"Al Bahah\", \n                              str_detect(Region, \"Qu?assim\") ~ \"Al Qasim\",\n                              str_detect(Region, \"Asir\") ~ \"`Asir\",\n                              str_detect(Region, \"Hail\") ~ \"Ha'il\",\n                              str_detect(Region, \"[Mm]adin\") ~ \"Al Madinah al Munawwarah\",\n                              str_detect(Region, \"Jizan\") ~ \"Jazan\",\n                              str_detect(Region, \"Makka\") ~ \"Makkah al Mukarramah\",\n                              str_detect(Region, \"Sharqiya\" ) ~ \"Al Mintaqah ash Sharqiyah\",\n                              str_detect(Region, \"Northern Frontier\") ~ \"Al Hudud ash Shamaliyah\",\n                              str_detect(Region, \"Riyad\") ~ \"Ar Riyadh\",\n                              TRUE ~ Region ))",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#calculate-regional-numerators-and-denominators",
    "href": "flu.html#calculate-regional-numerators-and-denominators",
    "title": "8  Flu vaccination coverage",
    "section": "8.3 Calculate regional numerators and denominators",
    "text": "8.3 Calculate regional numerators and denominators\n\nCalculate region-by-gender populations for 0-18 and 65+\nCalculate region-by-gender vaccinations for 0-18 and 65+\n\n\n\nCode\npop_paed &lt;- popns |&gt;\n    group_by(Region, Gender, paed) |&gt;\n    reframe(pop = sum(Population)) |&gt;\n    filter(paed == \"TRUE\") |&gt;\n    mutate(Gender = recode(Gender, \"Female\" = \"female\", \"Male\" = \"male\"), \n           Region = recode(Region, \"`Asir\" = \"'Asir\"))\n\npop_older &lt;-popns |&gt;\n    group_by(Region, Gender, older) |&gt;\n    reframe(pop = sum(Population)) |&gt;\n    filter(older == \"TRUE\") |&gt;\n    mutate(Gender = recode(Gender, \"Female\" = \"female\", \"Male\" = \"male\"), \n           Region = recode(Region, \"`Asir\" = \"'Asir\"))\n\n## fills all region-gender categories and remove unknown\npaed_flu &lt;- flu_data |&gt;\n    filter(paed == \"TRUE\") |&gt;\n    count(Region, Gender) |&gt;\n    complete(Region, Gender) |&gt;\n    filter(Gender != \"unknown\") |&gt;\n    mutate( Region = recode(Region, \"`Asir\" = \"'Asir\"))\n\nolder_flu &lt;- flu_data |&gt;\n    filter(older == \"TRUE\") |&gt;\n    count(Region, Gender) |&gt;\n    complete(Region, Gender) |&gt;\n    filter(Gender != \"unknown\") |&gt;\n    mutate( Region = recode(Region, \"`Asir\" = \"'Asir\"))",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#join-populations-and-vaccination-data",
    "href": "flu.html#join-populations-and-vaccination-data",
    "title": "8  Flu vaccination coverage",
    "section": "8.4 Join populations and vaccination data",
    "text": "8.4 Join populations and vaccination data\n\n\nCode\npaed_nd &lt;- paed_flu |&gt;\n  left_join(pop_paed) |&gt;\n  select(-paed)\n\nolder_nd &lt;- older_flu |&gt;\n  left_join(pop_older) |&gt;\n  select(-older)",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#calculate-coverage-by-age-group",
    "href": "flu.html#calculate-coverage-by-age-group",
    "title": "8  Flu vaccination coverage",
    "section": "8.5 Calculate coverage by age group",
    "text": "8.5 Calculate coverage by age group\n\n\nCode\npaed_coverage &lt;- paed_nd |&gt;\n  phe_proportion(x = n, n = pop) |&gt;\n  mutate(age = \"0-18\")    \n\nolder_coverage &lt;- older_nd |&gt;\n  phe_proportion(x = n, n = pop) |&gt;\n  mutate(age = \"65+\")\n\nbind_rows(paed_coverage, older_coverage) |&gt;\n    write_csv(\"data/flu_coverage.csv\")",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#tabulate",
    "href": "flu.html#tabulate",
    "title": "8  Flu vaccination coverage",
    "section": "8.6 Tabulate",
    "text": "8.6 Tabulate\n\n\nCode\noptions(digits = 3)\n\npaed_coverage |&gt;\n  select(-c(statistic, method)) |&gt;\n  head() |&gt;\n  flextable()\nolder_coverage |&gt;\n  select(-c(statistic, method)) |&gt;\n  head() |&gt;\n  flextable()\n\n\n\n\nTable 8.1: Flu vaccination coverage\n\n\n\nRegionGendernpopvaluelowerclupperclconfidenceage'Asirfemale161335,0110.00048060.000411870.000560795%0-18'Asirmale33347,7510.00009490.000067570.000133395%0-18Al Bahahfemale3857,2300.00066400.000483820.000911295%0-18Al Bahahmale259,0770.00003390.000009280.000123495%0-18Al Hudud ash Shamaliyahfemale170,3500.00001420.000002510.000080595%0-18Al Hudud ash Shamaliyahmale73,06895%0-18\n\n\nRegionGendernpopvaluelowerclupperclconfidenceage'Asirfemale4932,2240.0015210.00115050.00201095%65+'Asirmale1036,2880.0002760.00014970.00050795%65+Al Bahahfemale17,7910.0001280.00002270.00072795%65+Al Bahahmale6,75295%65+Al Madinah al Munawwarahfemale2431,0990.0007720.00051870.00114895%65+Al Madinah al Munawwarahmale1431,2310.0004480.00026710.00075295%65+",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "flu.html#visualise",
    "href": "flu.html#visualise",
    "title": "8  Flu vaccination coverage",
    "section": "8.7 Visualise",
    "text": "8.7 Visualise\n\n\nCode\npaed_coverage |&gt;\n  ggplot() +\n  geom_col(aes(Region, value, fill = Gender)) +\n  geom_linerange(aes(Region, ymin = lowercl, ymax = uppercl)) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1) ) +\n  facet_wrap(~ Gender) +\n  scale_fill_manual(values = c(\"blue\", \"red\"))\n\n\nolder_coverage |&gt;\n  ggplot() +\n  geom_col(aes(Region, value, fill = Gender)) +\n  geom_linerange(aes(Region, ymin = lowercl, ymax = uppercl)) +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1) ) +\n  facet_wrap(~ Gender) +\n  scale_fill_manual(values = c(\"blue\", \"red\")) \n\n\n\n\n\n\n\n\n\n\n\n(a) Paediatric coverage\n\n\n\n\n\n\n\n\n\n\n\n(b) 65+ coverage\n\n\n\n\n\n\nFigure 8.2: Flu vaccination coverage",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Flu vaccination coverage</span>"
    ]
  },
  {
    "objectID": "injury.html",
    "href": "injury.html",
    "title": "9  Injury",
    "section": "",
    "text": "9.1 Injury\nFirst, load injury and population data\nage          code            diagnosis            Gender         \n Min.   : 1    Length:10380       Length:10380       Length:10380      \n 1st Qu.:27    Class :character   Class :character   Class :character  \n Median :38    Mode  :character   Mode  :character   Mode  :character  \n Mean   :39                                                            \n 3rd Qu.:53                                                            \n Max.   :84                                                            \n NA's   :773                                                           \n    Region         \n Length:10380      \n Class :character  \n Mode  :character  \n                   \n                   \n                   \n                   \n\n\n\n\n\n\n\n\nFigure 9.1: Age distribution of injury admissions\nOverall there are 10380 records, of which 773 (7.45% ) have missing dates of of birth. These are excluded from analyis\nThe data contains values for 12 of the 13 regions.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Injury</span>"
    ]
  },
  {
    "objectID": "injury.html#aggregate-injury-data",
    "href": "injury.html#aggregate-injury-data",
    "title": "9  Injury",
    "section": "9.2 Aggregate injury data",
    "text": "9.2 Aggregate injury data\n\n\nRegiondiagnosiscodeage_bandFemaleMaleMakkahOpen wound of headS01[25,30)20Northern FrontierOpen wound of headS01[20,25)15Northern FrontierOpen wound of headS01[25,30)10Northern FrontierOpen wound of headS01[30,35)166Northern FrontierOpen wound of headS01[35,40)2Northern FrontierOpen wound of headS01[40,45)82",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Injury</span>"
    ]
  },
  {
    "objectID": "injury.html#recode-region-names-to-match-census-names",
    "href": "injury.html#recode-region-names-to-match-census-names",
    "title": "9  Injury",
    "section": "9.3 Recode region names to match census names",
    "text": "9.3 Recode region names to match census names\n\n\n[1] \"Al Jawf\" \"Jazan\"   \"Najran\" \n\n\n\n\n [1] \"0-4\"   \"5-9\"   \"10-14\" \"15-19\" \"20-24\" \"25-29\" \"30-34\" \"35-39\" \"40-44\"\n[10] \"45-49\" \"50-54\" \"55-59\" \"60-64\" \"65-69\" \"70-74\" \"75-79\" \"80+\"  \n\n\n [1] [40,45) [70,75) [35,40) [65,70) [15,20) [80,85) [55,60) [25,30) [30,35)\n[10] [60,65) [50,55) [0,5)   [45,50) [10,15) [20,25) [75,80)\n24 Levels: [0,5) [5,10) [10,15) [15,20) [20,25) [25,30) [30,35) ... [115,120)\n\n\n\n\n [1] 0-4   5-9   10-14 15-19 20-24 25-29 30-34 35-39 40-44 45-49 50-54 55-59\n[13] 60-64 65-69 70-74 75-79 80+  \n17 Levels: 0-4 5-9 10-14 15-19 20-24 25-29 30-34 35-39 40-44 45-49 ... 80+",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Injury</span>"
    ]
  },
  {
    "objectID": "injury.html#calculate-directly-age-standardised-rates-for-injury-admission-by-region-and-gender",
    "href": "injury.html#calculate-directly-age-standardised-rates-for-injury-admission-by-region-and-gender",
    "title": "9  Injury",
    "section": "9.4 Calculate directly age standardised rates for injury admission by region and gender",
    "text": "9.4 Calculate directly age standardised rates for injury admission by region and gender\nUse epitools::ageadjust.direct.\nTo iterate over regions and gender we’ll split by gender and use the nest_by function to group data by region and apply standardiastion function.\n\n\n\n\n\n\n\n\nFigure 9.2: Age standardised injury admission rate per 100,000 by region and gender",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Injury</span>"
    ]
  },
  {
    "objectID": "profile.html",
    "href": "profile.html",
    "title": "10  Health profile (1)",
    "section": "",
    "text": "10.1 Putting it all together\nHealth profiles combine multiple indicators to allow comparison, usually between population or administrative units e.g. regions, hospitals, ethnic groups, age groups and provide tools to facilitate a range of comparison.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Health profile (1)</span>"
    ]
  },
  {
    "objectID": "profile.html#putting-it-all-together",
    "href": "profile.html#putting-it-all-together",
    "title": "10  Health profile (1)",
    "section": "",
    "text": "10.1.1 Workflow\n\n\n\n\n\n\nflowchart TD\nA[Configure per-indicator data] --&gt; B[bind datasets]\n\n\n\n\n\nFigure 10.1: Proposed workflow for creating health profiles\n\n\n\n\n\nUK health profiles (for example, Public Health Outcome Framework) offer a wide range of comparison:\n\nBetween and within areas\nBetween age groups and genders",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Health profile (1)</span>"
    ]
  },
  {
    "objectID": "profile.html#visualisation",
    "href": "profile.html#visualisation",
    "title": "10  Health profile (1)",
    "section": "10.2 Visualisation",
    "text": "10.2 Visualisation\n\n\n\n\n\n\n\n\nComparison\nVisualisation\nComment\n\n\n\n\nSingle area, multiple indicators\nSpine or bullet chart\nIndicator values are scaled so that they can be directly compared. Single area (unit) values are usually encoded as a dot or line, plotted on a bar representing the range of values for all areas / units.\n\n\nMultiple areas, single indicator\nColumn / bar chart\nPlots can be ordered and plotted horizontally to enable rapid appraisal of relative performance. Confidence intervals can be added\n\n\nIndicator pairs / multiple indicators\nScatter plot or scatter plot matrices\nMay include smooths (lines representing fit to the data - common options are linear, loess and generalised additive models)\n\n\nSpatial variation\nChoropleth maps\nRequires boundary files and GIS tools\n\n\nOverview\nHeatmap / tile chart\nColour cells with statistical significance categories (e.g. high / low)\n\n\n\n\n\n\n\n\nWe will take the toolkit for plotting provided by the UKHSA which generates the charts used in the online version if the PHOF as a basis for plotting profiles. This is available at https://github.com/ukhsa-collaboration/fingertipscharts.\nNote: in the PHOF statistical significance is defined by whether the global average value (e.g. KSA) is contained with the confidence limits of the unit values (e.g. ’Asir region). It does not calculate limits for the global value. The rationale for this is explained in Public Health Data Science (2018)\n\n\nCode\n## install fingertipscharts\n## \n\nif(!require(\"fingertipscharts\")) devtools::install_github(\"https://github.com/ukhsa-collaboration/fingertipscharts\", force = TRUE)\n\nlibrary(fingertipscharts)\n\n\nTo use fingertipscharts data has to be in the right format.\nBar charts can be created using the compare_areas function\n\n\nCode\nsmok_rates |&gt;\n    compare_areas(area = region, value = value, lowerci = lowercl, upperci = uppercl, title = \"Rate of attendance at smoking clinics 18-44: F\")\n\nflu_coverage |&gt;\n    filter(gender == \"female\" & age == \"0-18\") |&gt;\n    compare_areas(area = region, value = value, lowerci = lowercl, upperci = uppercl, fill = gender, title = \"Flu vaccination coverage 0-18; F\")\n\n\n\n\n\n\n\n\n\n\n\n(a) Smoking rates\n\n\n\n\n\n\n\n\n\n\n\n(b) Paediatric flu coverage\n\n\n\n\n\n\nFigure 10.2: Using `compare-areas",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Health profile (1)</span>"
    ]
  },
  {
    "objectID": "profile.html#data-overview",
    "href": "profile.html#data-overview",
    "title": "10  Health profile (1)",
    "section": "10.3 Data overview",
    "text": "10.3 Data overview\nPHOF uses a heatmap (known as a “tartan rug” to display area by indicator summaries. The term tartan rug is used to refer to the colour scheme (red-amber-green) to denote statistical significance. The\n\n\nCode\nprof_data &lt;- bind_rows(smok_rates, flu_coverage) |&gt;\n    select(-c(11:13)) \n\n## calculate ksa values\nksa_values &lt;- prof_data |&gt;\n    group_by(indicator) |&gt;\n    reframe(ksa_values = 100000 * sum(n, na.rm = TRUE) / sum(pop))\n\n## join to data\nprof_data &lt;- prof_data |&gt;\n    left_join(ksa_values)\n\n## code for statistical significance\n\nprof_data &lt;- prof_data |&gt;\n    mutate(significance = case_when(lowercl &gt; ksa_values ~\"high\" ,\n                                     uppercl &lt; ksa_values~ \"low\",\n                                    TRUE ~ \"ns\"))\n\nhead(prof_data) |&gt;\n    gt::gt()\n\n\n\n\nTable 10.1: Required data format example\n\n\n\n\n\n\n\n\n\n\nindicator\nregion\nage\ngender\nn\npop\nvalue\nlowercl\nuppercl\ntimeperiod\nksa_values\nsignificance\n\n\n\n\nsmoking 18-44\n'Asir\n18-44\nfemale\nNA\n366324\nNA\nNA\nNA\n2023\n7.618658\nns\n\n\nsmoking 18-44\nAl Bahah\n18-44\nfemale\n28\n61969\n45.183882\n30.017729\n65.30573\n2023\n7.618658\nhigh\n\n\nsmoking 18-44\nAl Hudud ash Shamaliyah\n18-44\nfemale\n4\n70149\n5.702148\n1.553643\n14.59976\n2023\n7.618658\nns\n\n\nsmoking 18-44\nAl Jawf\n18-44\nfemale\n23\n103536\n22.214495\n14.077587\n33.33412\n2023\n7.618658\nhigh\n\n\nsmoking 18-44\nAl Madinah al Munawwarah\n18-44\nfemale\nNA\n387944\nNA\nNA\nNA\n2023\n7.618658\nns\n\n\nsmoking 18-44\nAl Mintaqah ash Sharqiyah\n18-44\nfemale\nNA\n877403\nNA\nNA\nNA\n2023\n7.618658\nns\n\n\n\n\n\n\n\n\n\n\n\n\n10.3.1 Heatmap\n\n\nCode\nprof_data |&gt;\n    ggplot() +\n    geom_tile(aes(region, indicator, fill = significance)) +\n    scale_fill_manual(values = c(\"red\", \"darkgreen\", \"goldenrod\")) +\n    scale_x_discrete(position = \"top\") +\n    theme(axis.text.x = element_text(angle = 90, hjust = 0)) +\n    labs(y = \"\", x = \"\")\n\n\n\n\n\n\n\n\n\n\n\n10.3.2 \n\n\n\n\n\n\nPublic Health Data Science. 2018. “PHDS Guidance - Confidence Intervals - Public Health Profiles.” Public Health England.",
    "crumbs": [
      "<span class='chapter-number'>10</span>  <span class='chapter-title'>Health profile (1)</span>"
    ]
  },
  {
    "objectID": "hp-2.html",
    "href": "hp-2.html",
    "title": "11  Health profile (2)",
    "section": "",
    "text": "11.0.1 Boundary file\nA regional boundary file is downloaded as part of the data pre-processing step and is contained in the object sa_bound.\nThis can be plotted as a static or interactive map:\n\n\nCode\nksa_bound |&gt;\n    ggplot() +\n    geom_sf()\n\nmapview(ksa_bound)\n\n\n\n\n\n\n\n\n\n\n\n(a) static\n\n\n\n\n\n\n\n\n\n\n(b) static\n\n\n\n\n\n\nFigure 11.1: KSA boundary map\n\n\n\n\n\n\n11.0.2 Plot data\nAttribute data (e..g area rates) needs to be combined with the boundary data in order to map them. Taking the example of injury….\n\n\nCode\ninj &lt;- read_csv(\"data/injury_dsr.csv\")\n\n\n\n\n11.0.3 Rename regions to link to spatial file\n\n\nCode\nsetdiff(inj$region, ksa_bound$ADM1_EN)\n\n\n[1] \"'Asir\"                     \"Al Madinah al Munawwarah\" \n[3] \"Al Mintaqah ash Sharqiyah\" \"Al Qasim\"                 \n[5] \"Ar Riyadh\"                 \"Jazan\"                    \n[7] \"Makkah al Mukarramah\"     \n\n\nCode\nksa_bound$ADM1_EN \n\n\n [1] \"`Asir\"                   \"Al Bahah\"               \n [3] \"Al Hudud ash Shamaliyah\" \"Al Jawf\"                \n [5] \"Al Madinah\"              \"Al Quassim\"             \n [7] \"Ar Riyad\"                \"Ash Sharqiyah\"          \n [9] \"Ha'il\"                   \"Jizan\"                  \n[11] \"Makkah\"                  \"Najran\"                 \n[13] \"Tabuk\"                  \n\n\nCode\n## recode area names and join to boundary data\ninj_sf &lt;- inj |&gt;\n    mutate(region1 = recode(region, \n                           \"'Asir\" = \"`Asir\", \n                           \"Al Madinah al Munawwarah\" = \"Al Madinah\",\n                           \"Al Qasim\" = \"Al Quassim\", \n                           \"Makkah al Mukarramah\" = \"Makkah\", \n                           \"Al Mintaqah ash Sharqiyah\" = \"Ash Sharqiyah\", \n                           \"Ar Riyadh\" = \"Ar Riyad\", \n                           \"Jazan\" = \"Jizan\"), \n           region1 = ifelse(region1 != region, region1, region)\n           )\n\ninj_sf &lt;- left_join(ksa_bound, inj_sf,  by = c(\"ADM1_EN\" = \"region1\")) \n\ninj_sf |&gt;\n    filter(is.na(gender))\n\n\nSimple feature collection with 1 feature and 19 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 34.4943 ymin: 24.53653 xmax: 40.17387 ymax: 28.98889\nGeodetic CRS:  WGS 84\n# A tibble: 1 × 20\n  gml_id Shape_Leng Shape_Area ADM1_EN ADM1_PCODE ADM1_REF ADM1ALT1EN ADM1ALT2EN\n* &lt;chr&gt;       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;     \n1 ksa_b…       34.6       9.05 Tabuk   SA07       &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;      \n# ℹ 12 more variables: ADM0_EN &lt;chr&gt;, ADM0_PCODE &lt;chr&gt;, date &lt;date&gt;,\n#   validOn &lt;date&gt;, validTo &lt;date&gt;, geometryProperty &lt;MULTIPOLYGON [°]&gt;,\n#   region &lt;chr&gt;, crude.rate &lt;dbl&gt;, adj.rate &lt;dbl&gt;, lci &lt;dbl&gt;, uci &lt;dbl&gt;,\n#   gender &lt;chr&gt;\n\n\n\n\n11.0.4 Plot smoking rates as choropleth map\n\n\nCode\n## convert back to spatial data and plot\ninj_sf |&gt; st_as_sf() |&gt;\n    filter(!is.na(gender)) |&gt;\n    ggplot() +\n    geom_sf(data = ksa_bound) +\n    geom_sf(aes(fill = 100000 * adj.rate)) +\n    ggplot2::geom_sf_label(aes(label = ADM1_EN)) +\n    facet_wrap(~ gender, ncol = 1) +\n    theme_void() +\n    scale_fill_viridis_c(name = \"DSR Injury\\nper 100,000\")\n\nmapview(inj_sf |&gt; st_as_sf() |&gt;\n    filter(gender == \"female\") |&gt; mutate(adj.rate = 100000 * adj.rate), zcol = \"adj.rate\") \n\n\n\n\n\n\n\n\n\n\n\n(a) Static\n\n\n\n\n\n\n\n\n\n\n(b) Static\n\n\n\n\n\n\nFigure 11.2: Smoking rate map",
    "crumbs": [
      "<span class='chapter-number'>11</span>  <span class='chapter-title'>Health profile (2)</span>"
    ]
  },
  {
    "objectID": "references.html",
    "href": "references.html",
    "title": "References",
    "section": "",
    "text": "Algabbani, Aljoharah Mohammed, Rasha Almubark, Nora Althumiri, Amani\nAlqahtani, and Nasser BinDhim. 2018. “The Prevalence of Cigarette\nSmoking in Saudi Arabia in 2018.” Food and Drug Regulatory\nScience Journal 1 (1): 1. https://doi.org/10.32868/rsj.v1i1.22.\n\n\n“Prevalence of Smoking.” n.d. https://doi.org/10.1787/301887638251.\n\n\nPublic Health Data Science. 2018. “PHDS Guidance -\nConfidence Intervals - Public Health Profiles.” Public Health\nEngland.\n\n\nXiang, Hong, Deshi Dong, Linlin Lv, and Xufeng Tao. 2023. “Global\nBurden of Disease Study 2019 Indicates That Smoking Gradually Becomes a\nKey Driver of the Burden of Pancreatic Cancer in Developing\nRegions.” In. IntechOpen. https://doi.org/10.5772/intechopen.1003616.",
    "crumbs": [
      "References"
    ]
  }
]