---
title: "Smoking"
format: html
editor: visual
execute: 
  warning: false
---

## 

```{r}
#| label: setup
#| include: false


needs(tidyverse, data.table, googledrive, readxl, skimr, janitor, gt, gtsummary, collapsibleTree, PHEindicatormethods, ggthemes, sf, tmap, ggspatial, curl, raster, stars)

theme_set(ggthemes::theme_economist())

dir <- here::here("~/spha/data/fwdatastrategypocpublichealthframeworkindicators")

smoking <-  fread("/Users/julianflowers/spha-1/data/fwdatastrategypocpublichealthframeworkindicators/Smoking 2022.csv")


```

### Data preparation

```{r}
#| label: create age bands

smoking <- smoking[, `:=` (five_year = cut(age, breaks = seq(0, 100, 5), right = FALSE), `18-44` = between(age, 18, 44), `15+` = age >= 15)][]

```

### Calculate numerator and denominator

```{r}
#| label: numerator

smoking[patient_gender == "female" & `18-44` == TRUE, .N, by = .(directorate_name, year)]

## probably better - easier to calculate / matching age bands/ more statitsical power NB crude rates

smoking[patient_gender == "female" & `15+` == TRUE, .N, by = .(directorate_name, year)]

## denominator

```

