---
title: "Dashboard"
format: 
    dashboard:
        scrolling: true
---

```{r}
needs(tidyverse, crosstalk, DT, plotly, gt, readxl, Hmisc)

data <- read_csv("data/pop_rates.csv")

amr <- read_xlsx("data/AMR 2022 POC.xlsx") |>
    janitor::clean_names() |>
    select(age_year, community_origin, pathogen_name:spectinomycin) |>
    pivot_longer(names_to = "antibiotic", values_to = "resistance", cols = 4:26) |>
        mutate(age_band = cut2(age_year, cuts = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 118))) |>
    count(age_band, pathogen_name, antibiotic, resistance)


sharedP <- SharedData$new(data)
shared_amr <- SharedData$new(amr)


```

# {.sidebar}

Simple static dashboard

```{r}
filter_checkbox("gender", "Gender", sharedP, ~ gender)
filter_checkbox("region", "Region", sharedP, ~ Region)
filter_checkbox("ind", "Indicator", sharedP, ~ Indicator)


```


---

```{r}
filter_checkbox("path", "Pathogen", shared_amr, ~ pathogen_name)
filter_checkbox("antibiotic", "Antibiotic", shared_amr, ~ antibiotic)

```


# Analysis
### Column

```{r}
#| title: "Slider"
#| eval: false

slider_width = 800

htmltools::div(
    
    id = "sliderdiv",
    filter_slider("bill_mm", "bill_length", sharedP, ~bill_length_mm, width = slider_width)
    
)
    
```

### column {width=100}

```{r}
#| content: valuebox
#| title: "Records no."
#| eval: false

list(
    icon = "tencent_qq",
    colour = "primary",
    value = nrow(data)
)

```

## row (height = 80%)

```{r}
#| title: "Rates"

p <- sharedP |>
    ggplot(aes(age_band, value, colour = Indicator, shape = gender)) + 
    geom_point() +
    facet_wrap(~Indicator + gender, ncol = 2, scales = "free") +
    labs(y = "Rate")

ggplotly(p)

```

# Table

```{r}
#| title: "Indicator data"

DT::datatable(sharedP)

```

# AMR

```{r}
#| title: "AMR data"

DT::datatable(shared_amr)

```

# AMR charts

```{r}

amr |>
    head()



```

