{
  "hash": "f6d518ce3dc01598b1205bfe1a34b9c5",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"AMR walkthrough\"\nauthor: \"Julian Flowers\"\ndate: \"2024-07-23\"\nformat: \n    html:\n       toc: true\n       toc-location: right\n       code-fold: true\n       code-tools: true\n       fig-height: 10\n       fig-width: 8\neditor: visual\nexecute: \n  warning: false\n  message: false\n---\n\n\n\n\n## Introduction\n\nThis document outlines a stepwise approach to calculating AMR indicators from dummy data kindly supplied by PHA.\n\nThere are x steps\n\n1.  EDA (exploratory data analysis of raw data) - this involves cleaning, visualisation and creation of relevant variables.\n\n2.  Review of indicator definitions\n\n    -   Numerator\n\n    -   Denominator\n\n3.  Method for calculating numerator and denominator values from dataset. The outline uses R code for reproducibility and flexibility.\n\n4.  Calculating indicator values and uncertainty intervals\n\n5.  Suggested indicator visualisations (if appropriate).\n\n## AMR indicators\n\n### MRSA\n\n> Percentage of bloodstream infection due to methicillin-resistant Staphylococcus aureus (MRSA)\n\n> Numerator: No. of patients with growth of methicillin-resistant S. aureus in tested blood samples\n\n> Denominator: Total No. of patients with growth of S. aureus in tested blood samples\n\n### E. coli\n\n> Percentage of bloodstream infection due to 3rd-generation cephalosporin resistant E. coli\n\n> Numerator: No. of patients with growth of 3rd-generation cephalosporin resistant E. coli in tested blood samples\n\n> Denominator: Total No. of patients with growth of E. coli in tested blood samples\n\n### Import data\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- amr\n```\n:::\n\n\n334 observations\n\n## Data preparation\n\n### calculate 5-year age bands\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr <- amr[, `:=` (age_band = cut(age_year, breaks = seq(0, 100, 5), right = FALSE))][]\n\nhead(amr)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   record_number sample_no patient_mrn   location\n           <num>    <char>      <char>     <char>\n1:             1    ######       ##### Outpatient\n2:            17    ######       #####  Inpatient\n3:            20    ######       #####  Inpatient\n4:            25    ######       #####  Inpatient\n5:            43    ######       ##### Outpatient\n6:            63    ######       ##### Outpatient\n                                                     patient_hospitalized\n                                                                   <char>\n1: Patient had NOT been admitted for more than 2 days in the past 30 days\n2:                       Patient has been hospitalized for 2 days or less\n3:                     Patient has been hospitalized for more than 2 days\n4:                       Patient has been hospitalized for 2 days or less\n5: Patient had NOT been admitted for more than 2 days in the past 30 days\n6: Patient had NOT been admitted for more than 2 days in the past 30 days\n     specific_location age_year community_origin   site first_name second_name\n                <char>    <num>           <char> <char>     <char>      <char>\n1:      Emergency Room        0 Community Origin  Blood       ####       #####\n2: Intensive Care Unit       71 Community Origin  Blood       ####       #####\n3: Intensive Care Unit       44  Hospital Origin  Blood       ####       #####\n4: Intensive Care Unit       67 Community Origin  Blood       ####       #####\n5:      Emergency Room       67 Community Origin  Blood       ####       #####\n6:      Emergency Room       92 Community Origin  Blood       ####       #####\n   family_name national_iqama_id nationality    pathogen_name minocycline\n        <char>            <char>      <char>           <char>      <lgcl>\n1:        ####        ##########       ##### Escherichia coli          NA\n2:        ####        ##########       ##### Escherichia coli          NA\n3:        ####        ##########       ##### Escherichia coli          NA\n4:        ####        ##########       ##### Escherichia coli          NA\n5:        ####        ##########       ##### Escherichia coli          NA\n6:        ####        ##########       ##### Escherichia coli          NA\n   tigecycline ampicillin penicillin_g oxacillin cefoxitin cefotaxime\n        <lgcl>     <char>       <lgcl>    <char>    <char>     <char>\n1:          NA          R           NA      <NA>      <NA>          R\n2:          NA          R           NA      <NA>      <NA>         NA\n3:          NA          S           NA      <NA>      <NA>          S\n4:          NA          R           NA      <NA>      <NA>          R\n5:          NA          R           NA      <NA>      <NA>         NA\n6:          NA          R           NA      <NA>      <NA>         NA\n   ceftazidime ceftriaxone cefixime cefepime doripenem ertapenem imipenem\n        <char>      <char>   <lgcl>   <char>    <char>    <char>   <char>\n1:           R           R       NA        R        NA         S        S\n2:           S           S       NA        S        NA         S        S\n3:           S           S       NA        S        NA         S        S\n4:           R           R       NA        R        NA         S        S\n5:           I           S       NA        S        NA         S        S\n6:           R           R       NA        R         R         S        S\n   meropenem co_trimoxazole azithromycin amikacin gentamicin ciprofloxacin\n      <char>         <char>       <lgcl>   <lgcl>     <lgcl>        <char>\n1:         S              S           NA       NA         NA             S\n2:         S              S           NA       NA         NA             S\n3:         S              S           NA       NA         NA             S\n4:         S              R           NA       NA         NA             S\n5:         S              S           NA       NA         NA             S\n6:         S              R           NA       NA         NA             R\n   levofloxacin colistin spectinomycin age_band\n         <char>   <char>        <lgcl>   <fctr>\n1:            S       NA            NA    [0,5)\n2:            S        S            NA  [70,75)\n3:            S       NA            NA  [40,45)\n4:            S       NA            NA  [65,70)\n5:            S        S            NA  [65,70)\n6:            R        S            NA  [90,95)\n```\n\n\n:::\n:::\n\n\n### remove non-relevant data\n\nThis step removes identifiers (names, record IDs)\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr <- amr |> select(-c(family_name, first_name, sample_no, patient_mrn, second_name, national_iqama_id, nationality))\n```\n:::\n\n\n### create per test file (long data)\n\n-   this create a *per test* dataset rather than a per patient sample dataset\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_long <- amr |>\n    pivot_longer(names_to = \"antibiotic\", values_to = \"resistance\", cols = minocycline:spectinomycin) |> setDT()\n```\n:::\n\n\n### Recode 3rd generation cephalosporins\n\n-   this step adds a new variable which labels 3rd generation cephalosporins\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_long <- amr_long[, gen_3 := case_when(str_detect(antibiotic, \"cef\") ~ \"3rd-gen\", TRUE ~ \"other\")][]\n```\n:::\n\n\n## Data summarisation and description (EDA)\n\n-   first generate a high level tabular summary\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngtsummary::tbl_summary(amr)\n```\n:::\n\n\n-   represent this visually - we'll use decomposition trees\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_freq <- amr_long[pathogen_name == \"Escherichia coli\", .N, by = .(age_band, gen_3, resistance, pathogen_name, community_origin)]\n\ncollapsibleTreeSummary(amr_freq, \n                       c( \"community_origin\", \"gen_3\",\"resistance\"), \n                       root = \"E. coli\", \n                       nodeSize = \"N\", \n                       attribute = \"N\", \n                       fontSize = 16, \n                       collapsed = FALSE)\n```\n\n::: {#fig-decomposition-trees .cell-output-display}\n\n```{=html}\n<div class=\"collapsibleTree html-widget html-fill-item\" id=\"htmlwidget-d06fc0f886ff74462f5f\" style=\"width:100%;height:975px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-d06fc0f886ff74462f5f\">{\"x\":{\"data\":{\"name\":\"E. coli\",\"fill\":\"#D33F6A\",\"SizeOfNode\":19.87,\"WeightOfNode\":\"61\",\"children\":[{\"name\":\"Community Origin\",\"fill\":\"#D33F6A\",\"SizeOfNode\":16.29,\"WeightOfNode\":\"41\",\"children\":[{\"name\":\"other\",\"fill\":\"#D33F6A\",\"SizeOfNode\":10.49,\"WeightOfNode\":\"17\",\"children\":[{\"name\":\"S\",\"fill\":\"#D33F6A\",\"SizeOfNode\":7.63,\"WeightOfNode\":\"9\"},{\"name\":\"R\",\"fill\":\"#E1704C\",\"SizeOfNode\":4.41,\"WeightOfNode\":\"3\"},{\"name\":\"NA\",\"fill\":\"#E1704C\",\"SizeOfNode\":4.41,\"WeightOfNode\":\"3\"},{\"name\":\"I\",\"fill\":\"#E99A2C\",\"SizeOfNode\":3.6,\"WeightOfNode\":\"2\"}]},{\"name\":\"3rd-gen\",\"fill\":\"#DD6157\",\"SizeOfNode\":7.2,\"WeightOfNode\":\"8\",\"children\":[{\"name\":\"S\",\"fill\":\"#D33F6A\",\"SizeOfNode\":4.41,\"WeightOfNode\":\"3\"},{\"name\":\"R\",\"fill\":\"#D33F6A\",\"SizeOfNode\":3.6,\"WeightOfNode\":\"2\"},{\"name\":\"NA\",\"fill\":\"#D33F6A\",\"SizeOfNode\":3.6,\"WeightOfNode\":\"2\"},{\"name\":\"I\",\"fill\":\"#E99A2C\",\"SizeOfNode\":2.54,\"WeightOfNode\":\"1\"}]}]},{\"name\":\"Hospital Origin\",\"fill\":\"#D33F6A\",\"SizeOfNode\":11.38,\"WeightOfNode\":\"20\",\"children\":[{\"name\":\"other\",\"fill\":\"#D33F6A\",\"SizeOfNode\":11.93,\"WeightOfNode\":\"22\",\"children\":[{\"name\":\"S\",\"fill\":\"#D33F6A\",\"SizeOfNode\":8.81,\"WeightOfNode\":\"12\"},{\"name\":\"R\",\"fill\":\"#D54865\",\"SizeOfNode\":5.69,\"WeightOfNode\":\"5\"},{\"name\":\"NA\",\"fill\":\"#E1704C\",\"SizeOfNode\":5.09,\"WeightOfNode\":\"4\"},{\"name\":\"I\",\"fill\":\"#E7CA45\",\"SizeOfNode\":2.54,\"WeightOfNode\":\"1\"}]},{\"name\":\"3rd-gen\",\"fill\":\"#D33F6A\",\"SizeOfNode\":10.18,\"WeightOfNode\":\"16\",\"children\":[{\"name\":\"R\",\"fill\":\"#D33F6A\",\"SizeOfNode\":7.2,\"WeightOfNode\":\"8\"},{\"name\":\"S\",\"fill\":\"#D33F6A\",\"SizeOfNode\":6.73,\"WeightOfNode\":\"7\"},{\"name\":\"NA\",\"fill\":\"#E8C33C\",\"SizeOfNode\":2.54,\"WeightOfNode\":\"1\"}]}]}]},\"options\":{\"hierarchy\":[\"community_origin\",\"gen_3\",\"resistance\"],\"input\":null,\"attribute\":\"N\",\"linkLength\":null,\"fontSize\":16,\"tooltip\":true,\"collapsed\":false,\"zoomable\":true,\"margin\":{\"top\":20,\"bottom\":20,\"left\":90.87,\"right\":41}}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nDecomposition tree for E. coli\n:::\n:::\n\n\n## Numerators and denominators\n\nTo calculate indicators we need to calculate\n\n-   patients with blood stream infection\n-   samples with antibiotic resistance\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_long\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nIndex: <pathogen_name>\n      record_number   location\n              <num>     <char>\n   1:             1 Outpatient\n   2:             1 Outpatient\n   3:             1 Outpatient\n   4:             1 Outpatient\n   5:             1 Outpatient\n  ---                         \n7678:          1210  Inpatient\n7679:          1210  Inpatient\n7680:          1210  Inpatient\n7681:          1210  Inpatient\n7682:          1210  Inpatient\n                                                        patient_hospitalized\n                                                                      <char>\n   1: Patient had NOT been admitted for more than 2 days in the past 30 days\n   2: Patient had NOT been admitted for more than 2 days in the past 30 days\n   3: Patient had NOT been admitted for more than 2 days in the past 30 days\n   4: Patient had NOT been admitted for more than 2 days in the past 30 days\n   5: Patient had NOT been admitted for more than 2 days in the past 30 days\n  ---                                                                       \n7678:                     Patient has been hospitalized for more than 2 days\n7679:                     Patient has been hospitalized for more than 2 days\n7680:                     Patient has been hospitalized for more than 2 days\n7681:                     Patient has been hospitalized for more than 2 days\n7682:                     Patient has been hospitalized for more than 2 days\n       specific_location age_year community_origin   site         pathogen_name\n                  <char>    <num>           <char> <char>                <char>\n   1:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   2:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   3:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   4:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n   5:     Emergency Room        0 Community Origin  Blood      Escherichia coli\n  ---                                                                          \n7678: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7679: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7680: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7681: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n7682: Non Intensive Unit       96  Hospital Origin  Blood Staphylococcus aureus\n      age_band    antibiotic resistance  gen_3\n        <fctr>        <char>     <char> <char>\n   1:    [0,5)   minocycline       <NA>  other\n   2:    [0,5)   tigecycline       <NA>  other\n   3:    [0,5)    ampicillin          R  other\n   4:    [0,5)  penicillin_g       <NA>  other\n   5:    [0,5)     oxacillin       <NA>  other\n  ---                                         \n7678: [95,100)    gentamicin       <NA>  other\n7679: [95,100) ciprofloxacin          R  other\n7680: [95,100)  levofloxacin          R  other\n7681: [95,100)      colistin         NA  other\n7682: [95,100) spectinomycin       <NA>  other\n```\n\n\n:::\n:::\n\n\n## Calculate resistance rates\n\n-   calculate proportion of tests resistant\n-   calculate confidence interval (using Wilson's score method for proportions via the `PHEindicatormethods` R package)\n\n\n::: {#tbl-E.coli .cell tbl-cap='E. coli resistance rates to 3rd generation cephalosporins'}\n\n```{.r .cell-code}\namr_long[pathogen_name == \"Escherichia coli\" & !is.na(resistance), .N, by = .(resistance, gen_3)] |>\n    pivot_wider(names_from = resistance, values_from = N) |>\n    rowwise() |>\n    mutate(total_tests = sum(c_across(R:I), na.rm = TRUE), \n           resistance_rate = R / total_tests) |>\n    flextable::flextable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-61c62552{}.cl-61c174e4{font-family:'Helvetica';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-61c35d72{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-61c35d7c{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-61c36cc2{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61c36ccc{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61c36ccd{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61c36cd6{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61c36cd7{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-61c36cd8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-61c62552'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-61c36cc2\"><p class=\"cl-61c35d72\"><span class=\"cl-61c174e4\">gen_3</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">R</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">NA</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">S</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">I</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">total_tests</span></p></th><th class=\"cl-61c36ccc\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">resistance_rate</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-61c36ccd\"><p class=\"cl-61c35d72\"><span class=\"cl-61c174e4\">other</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">300</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">193</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">646</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">7</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">1,146</span></p></td><td class=\"cl-61c36cd6\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">0.2617801</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-61c36cd7\"><p class=\"cl-61c35d72\"><span class=\"cl-61c174e4\">3rd-gen</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">269</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">56</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">192</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">4</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">521</span></p></td><td class=\"cl-61c36cd8\"><p class=\"cl-61c35d7c\"><span class=\"cl-61c174e4\">0.5163148</span></p></td></tr></tbody></table></div>\n```\n\n:::\n:::\n\n\n### by antibiotic\n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(digits = 2)\n\namr_res_ci_sa <- amr_long[pathogen_name == \"Staphylococcus aureus\" & !is.na(resistance), .N, by = .(antibiotic, resistance)] |>\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |>\n    rowwise() |>\n    mutate(total_tests = sum(c_across(S:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_sa, R, total_tests) |>\n    bind_cols(amr_res_ci_sa) |>\n    ggplot() +\n    geom_point(aes(reorder(antibiotic, value), value)) +\n    geom_linerange(aes(antibiotic, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"Staph. aureus resistance rate\", x = \"\") + \n    scale_y_continuous(position = \"right\")\n```\n\n::: {.cell-output-display}\n![](amr_poc_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n:::\n\n\n### by age\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_res_ci_age <- amr_long[pathogen_name == \"Staphylococcus aureus\" & !is.na(resistance), .N, by = .(age_band, resistance)] |>\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |>\n    rowwise() |>\n    mutate(total_tests = sum(c_across(S:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_age, R, total_tests) |>\n    bind_cols(amr_res_ci_age) |>\n    ggplot() +\n    geom_point(aes(reorder(age_band, value), value)) +\n    geom_linerange(aes(age_band, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"Staph. aureus resistance rate\", x = \"\") + \n    scale_y_continuous(position = \"right\")\n```\n\n::: {.cell-output-display}\n![](amr_poc_files/figure-html/by age-1.png){width=768}\n:::\n:::\n\n\n## E. coli\n\n\n::: {.cell}\n\n```{.r .cell-code}\namr_res_ci_ec <- amr_long[str_detect(pathogen_name, \"coli\") & !is.na(resistance), .N, by = .(antibiotic, resistance, gen_3)] |>\n    pivot_wider(names_from = resistance, values_from = N, values_fill = 0) |>\n    rowwise() |>\n    mutate(total_tests = sum(c_across(R:I), na.rm = TRUE), \n           resistance_rate = R / total_tests)\n\nphe_proportion(amr_res_ci_ec, R, total_tests) |>\n    bind_cols(amr_res_ci_ec) |>\n    ggplot() +\n    geom_point(aes(reorder(antibiotic, value), value, colour = gen_3)) +\n    geom_linerange(aes(antibiotic, ymin = lowercl, ymax = uppercl)) +\n    coord_flip() +\n    labs(y = \"E. coli resistance rate\", x = \"\") + scale_y_continuous(position = \"right\")\n```\n\n::: {.cell-output-display}\n![](amr_poc_files/figure-html/e coli-1.png){width=768}\n:::\n:::\n",
    "supporting": [
      "amr_poc_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/htmltools-fill-0.5.8.1/fill.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<script src=\"site_libs/d3-4.10.2/d3.min.js\"></script>\n<link href=\"site_libs/collapsibleTree-0.1.6/collapsibleTree.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/collapsibleTree-binding-0.1.8/collapsibleTree.js\"></script>\n<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}