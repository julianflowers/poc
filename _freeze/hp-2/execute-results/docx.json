{
  "hash": "9c13ff8a82d421fc0c7c3064609ff263",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Health profile (2)\"\nsubtitle: \"Maps\"\nformat: \n    html: \n        fig-width: 8\n        fig-height: 8\n        fig-cap: bottom\nexecute: \n  freeze: true\n---\n\n\n\n\n\n### Boundary file\n\nA regional boundary file is downloaded as part of the data pre-processing step and is contained in the object `sa_bound`.\n\nThis can be plotted as a static or interactive map:\n\n\n\n::: {#fig-basic-map .cell}\n\n```{.r .cell-code}\nksa_bound |>\n    ggplot() +\n    geom_sf()\n\nmapview(ksa_bound)\n```\n\n::: {.cell-output-display}\n![static](hp-2_files/figure-docx/fig-basic-map-1.png){#fig-basic-map-1}\n:::\n\n::: {.cell-output-display}\n![interactive](hp-2_files/figure-docx/fig-basic-map-2.png){#fig-basic-map-2}\n:::\n\nKSA boundary map\n:::\n\n\n\n### Plot data\n\nAttribute data (e..g area rates) needs to be combined with the boundary data in order to map them. Taking the example of injury....\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninj <- read_csv(\"data/injury_dsr.csv\")\n```\n:::\n\n\n\n### Rename regions to link to spatial file\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsetdiff(inj$region, ksa_bound$ADM1_EN)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"'Asir\"                     \"Al Madinah al Munawwarah\" \n[3] \"Al Mintaqah ash Sharqiyah\" \"Al Qasim\"                 \n[5] \"Ar Riyadh\"                 \"Jazan\"                    \n[7] \"Makkah al Mukarramah\"     \n```\n\n\n:::\n\n```{.r .cell-code}\nksa_bound$ADM1_EN \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"`Asir\"                   \"Al Bahah\"               \n [3] \"Al Hudud ash Shamaliyah\" \"Al Jawf\"                \n [5] \"Al Madinah\"              \"Al Quassim\"             \n [7] \"Ar Riyad\"                \"Ash Sharqiyah\"          \n [9] \"Ha'il\"                   \"Jizan\"                  \n[11] \"Makkah\"                  \"Najran\"                 \n[13] \"Tabuk\"                  \n```\n\n\n:::\n\n```{.r .cell-code}\n## recode area names and join to boundary data\ninj_sf <- inj |>\n    mutate(region1 = recode(region, \n                           \"'Asir\" = \"`Asir\", \n                           \"Al Madinah al Munawwarah\" = \"Al Madinah\",\n                           \"Al Qasim\" = \"Al Quassim\", \n                           \"Makkah al Mukarramah\" = \"Makkah\", \n                           \"Al Mintaqah ash Sharqiyah\" = \"Ash Sharqiyah\", \n                           \"Ar Riyadh\" = \"Ar Riyad\", \n                           \"Jazan\" = \"Jizan\"), \n           region1 = ifelse(region1 != region, region1, region)\n           )\n\ninj_sf <- left_join(ksa_bound, inj_sf,  by = c(\"ADM1_EN\" = \"region1\")) \n\ninj_sf |>\n    filter(is.na(gender))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 19 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 34.4943 ymin: 24.53653 xmax: 40.17387 ymax: 28.98889\nGeodetic CRS:  WGS 84\n# A tibble: 1 × 20\n  gml_id Shape_Leng Shape_Area ADM1_EN ADM1_PCODE ADM1_REF ADM1ALT1EN ADM1ALT2EN\n* <chr>       <dbl>      <dbl> <chr>   <chr>      <chr>    <chr>      <chr>     \n1 ksa_b…       34.6       9.05 Tabuk   SA07       <NA>     <NA>       <NA>      \n# ℹ 12 more variables: ADM0_EN <chr>, ADM0_PCODE <chr>, date <date>,\n#   validOn <date>, validTo <date>, geometryProperty <MULTIPOLYGON [°]>,\n#   region <chr>, crude.rate <dbl>, adj.rate <dbl>, lci <dbl>, uci <dbl>,\n#   gender <chr>\n```\n\n\n:::\n:::\n\n\n\n### Plot smoking rates as choropleth map\n\n\n\n::: {#fig-sm-map .cell}\n\n```{.r .cell-code}\n## convert back to spatial data and plot\ninj_sf |> st_as_sf() |>\n    filter(!is.na(gender)) |>\n    ggplot() +\n    geom_sf(data = ksa_bound) +\n    geom_sf(aes(fill = 100000 * adj.rate)) +\n    ggplot2::geom_sf_label(aes(label = ADM1_EN)) +\n    facet_wrap(~ gender) +\n    theme_void() +\n    scale_fill_viridis_c(name = \"DSR Injury\\nper 100,000\")\n\nmapview(inj_sf |> st_as_sf() |>\n    filter(gender == \"female\") |> mutate(adj.rate = 100000 * adj.rate), zcol = \"adj.rate\") \n```\n\n::: {.cell-output-display}\n![Static](hp-2_files/figure-docx/fig-sm-map-1.png){#fig-sm-map-1}\n:::\n\n::: {.cell-output-display}\n![Interactive](hp-2_files/figure-docx/fig-sm-map-2.png){#fig-sm-map-2}\n:::\n\nSmoking rate map\n:::\n",
    "supporting": [
      "hp-2_files/figure-docx"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{},\"value\":[]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}